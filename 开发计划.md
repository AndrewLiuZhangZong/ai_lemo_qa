# AI智能客服问答系统开发计划

## 项目进度追踪

### ✅ Phase 0: 基础设施部署（已完成）
- [x] Docker Compose环境搭建
- [x] PostgreSQL数据库部署
- [x] Redis缓存部署
- [x] Milvus向量数据库部署
- [x] Ollama LLM部署（Qwen3-8B）

### ✅ Phase 1: 项目初始化（已完成）
- [x] 创建Python项目结构
- [x] 配置依赖管理（requirements.txt）
- [x] 配置环境变量管理
- [x] 创建数据库连接模块
- [x] 创建日志配置

### ✅ Phase 2: 数据层开发（已完成）
- [x] 定义SQLAlchemy数据模型
- [x] 创建数据库会话管理
- [x] 实现知识库CRUD操作
- [x] 实现对话历史记录功能

### ✅ Phase 3: 核心服务开发（已完成）
- [x] Embedding服务（文本向量化）
  - 集成Ollama Embedding API
  - 实现文本批量向量化
- [x] Milvus服务（向量检索）
  - 创建向量集合
  - 实现向量存储和检索
  - 实现相似度搜索
- [x] LLM服务（问答生成）
  - 集成Ollama Chat API
  - 实现Prompt工程
  - 实现上下文管理
- [x] 对话服务（核心业务逻辑）
  - 实现问答流程编排
  - 实现知识检索+LLM增强

### ✅ Phase 4: API接口开发（已完成）
- [x] 创建FastAPI应用
- [x] 实现问答接口（/api/v1/chat）
- [x] 实现知识库管理接口
  - POST /api/v1/knowledge - 添加知识
  - GET /api/v1/knowledge - 查询知识
  - PUT /api/v1/knowledge/{id} - 更新知识
  - DELETE /api/v1/knowledge/{id} - 删除知识
- [x] 实现反馈接口（/api/v1/feedback）
- [x] 实现健康检查接口（/health）
- [x] 配置CORS和中间件

### ✅ Phase 5: 高级功能增强（已完成）
- [x] 网络搜索服务集成（SearXNG）
- [x] 三级智能回退策略
  - 知识库优先（置信度 ≥ 20%）
  - 网络搜索补充（置信度 < 20%）
  - 通用AI兜底（搜索无果）
- [x] 答案来源标识功能
- [x] 实时日期时间注入

### ✅ Phase 6: 前端开发（已完成）
- [x] Vue 3 + Element Plus 项目搭建
- [x] 智能问答聊天界面
  - 实时对话展示
  - 答案来源标签（知识库/网络搜索/AI推理）
  - 置信度和意图显示
  - 相关问题推荐
  - 网络搜索来源链接展示
- [x] 知识库管理界面
  - 知识列表展示
  - 添加/编辑/删除功能
  - 搜索和分类筛选
  - 分页浏览
- [x] 响应式布局设计
- [x] API代理配置

### 🚀 Phase 7: 部署与上线
- [ ] 创建Dockerfile
- [ ] 更新docker-compose.yml
- [ ] 配置Nginx反向代理
- [ ] 生产环境部署文档

---

## 项目目录结构

```
ai_lemo_qa/
├── app/                        # 后端应用主目录
│   ├── __init__.py
│   ├── main.py                 # FastAPI应用入口
│   ├── api/                    # API路由
│   │   ├── __init__.py
│   │   ├── v1/                 # API v1版本
│   │   │   ├── __init__.py
│   │   │   ├── chat.py         # 问答接口
│   │   │   ├── knowledge.py    # 知识库管理接口
│   │   │   └── feedback.py     # 反馈接口
│   │   └── deps.py             # 依赖注入
│   ├── core/                   # 核心配置
│   │   ├── __init__.py
│   │   ├── config.py           # 配置管理
│   │   ├── database.py         # 数据库连接
│   │   └── logger.py           # 日志配置
│   ├── models/                 # 数据模型
│   │   ├── __init__.py
│   │   ├── knowledge.py        # 知识库模型
│   │   ├── conversation.py     # 对话历史模型
│   │   └── feedback.py         # 反馈模型
│   ├── schemas/                # Pydantic模型（数据验证）
│   │   ├── __init__.py
│   │   ├── chat.py             # 聊天请求/响应模型
│   │   ├── knowledge.py        # 知识库模型
│   │   └── feedback.py         # 反馈模型
│   ├── services/               # 业务逻辑服务
│   │   ├── __init__.py
│   │   ├── embedding.py        # Embedding服务
│   │   ├── milvus.py           # Milvus向量检索
│   │   ├── llm.py              # LLM对话服务
│   │   ├── search.py           # 网络搜索服务（SearXNG）
│   │   └── chat.py             # 问答业务逻辑
│   └── utils/                  # 工具函数
│       ├── __init__.py
│       └── text.py             # 文本处理工具
├── frontend/                   # 前端应用目录
│   ├── src/
│   │   ├── api/                # API接口封装
│   │   │   └── index.js        # Axios客户端
│   │   ├── views/              # 页面视图
│   │   │   ├── ChatView.vue    # 聊天界面
│   │   │   └── KnowledgeView.vue # 知识库管理
│   │   ├── router/             # 路由配置
│   │   │   └── index.js
│   │   ├── App.vue             # 根组件
│   │   └── main.js             # 入口文件
│   ├── index.html              # HTML模板
│   ├── vite.config.js          # Vite配置
│   ├── package.json            # 前端依赖
│   └── README.md               # 前端文档
├── config/                     # 配置文件目录
│   ├── milvus.yaml             # Milvus配置
│   └── searxng/                # SearXNG配置
│       └── settings.yml
├── scripts/                    # 脚本目录
│   ├── init.sql                # 数据库初始化
│   └── init_milvus.py          # Milvus初始化
├── logs/                       # 日志目录
├── docker-compose.yml          # Docker编排
├── Dockerfile                  # 应用容器化
├── requirements.txt            # Python依赖
├── .env                        # 环境变量
├── .gitignore                  # Git忽略文件
├── README.md                   # 项目说明
├── 需求文档.md                  # 需求文档
└── 开发计划.md                  # 开发计划
```

---

## 技术栈说明

### 后端技术栈

#### Web框架
- **FastAPI**: 现代、快速的Web框架
- **Uvicorn**: ASGI服务器
- **Pydantic**: 数据验证

#### 数据库
- **SQLAlchemy**: ORM框架
- **asyncpg**: 异步PostgreSQL驱动
- **redis-py**: Redis客户端
- **pymilvus**: Milvus Python SDK

#### AI/ML
- **ollama**: 本地LLM客户端（Qwen3-8B + nomic-embed-text）
- **numpy**: 向量归一化处理

#### 工具
- **python-dotenv**: 环境变量管理
- **loguru**: 日志管理
- **httpx**: HTTP客户端
- **requests**: SearXNG搜索请求

### 前端技术栈

#### 框架与UI
- **Vue 3**: 渐进式JavaScript框架（Composition API）
- **Element Plus**: Vue 3企业级UI组件库
- **Vite**: 下一代前端构建工具

#### 工具库
- **Vue Router 4**: 官方路由管理器
- **Axios**: Promise风格的HTTP客户端
- **@element-plus/icons-vue**: Element Plus图标库

### 基础设施
- **Docker**: 容器化部署
- **PostgreSQL 16**: 关系数据库
- **Redis 7**: 缓存与会话
- **Milvus**: 向量数据库
- **SearXNG**: 开源元搜索引擎

---

## 开发顺序

### 第一步：核心配置（今天完成）
1. 安装Python依赖
2. 创建配置管理模块
3. 测试数据库连接
4. 测试Ollama连接

### 第二步：数据模型（今天完成）
1. 定义SQLAlchemy模型
2. 创建Pydantic Schema
3. 测试数据库操作

### 第三步：服务层（明天）
1. 实现Embedding服务
2. 实现Milvus向量存储和检索
3. 实现LLM对话服务
4. 集成测试

### 第四步：API接口（明天）
1. 创建FastAPI应用
2. 实现问答接口
3. 实现知识库管理接口
4. API测试

### 第五步：完善功能（后天）
1. 添加会话管理
2. 添加错误处理
3. 添加日志记录
4. 性能优化

---

## 预期效果

### API示例

**问答接口**
```bash
curl -X POST "http://localhost:8080/api/v1/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "如何退货？",
    "session_id": "test-session-123"
  }'

# 响应
{
  "code": 200,
  "data": {
    "answer": "您可以在订单页面申请退货...",
    "confidence": 0.92,
    "sources": [{"id": 1, "question": "如何退货？"}],
    "related_questions": ["退货需要多久？", "退货运费谁承担？"]
  }
}
```

**添加知识**
```bash
curl -X POST "http://localhost:8080/api/v1/knowledge" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "如何修改订单地址？",
    "answer": "订单提交后30分钟内可自助修改地址...",
    "category": "订单问题"
  }'
```

---

## 性能目标

- **响应时间**: < 2秒
- **并发能力**: 50+ QPS
- **准确率**: > 85%
- **可用性**: 99%+

---

## 下一步行动

### ✅ 已完成
1. ✅ 创建项目结构
2. ✅ 编写核心配置代码
3. ✅ 编写数据模型和服务层
4. ✅ 实现API接口
5. ✅ 安装所有依赖
6. ✅ 本地测试运行
7. ✅ 完善反馈接口和健康检查
8. ✅ 集成网络搜索功能
9. ✅ 实现三级智能回退策略
10. ✅ 开发Vue前端界面
11. ✅ 前后端联调测试

### 🎯 待完成（生产部署）
1. 📦 编写Dockerfile（后端）
2. 🐳 完善docker-compose.yml（生产环境）
3. 🌐 配置Nginx反向代理
4. 📊 添加监控告警（Prometheus + Grafana）
5. 📝 编写部署文档

系统核心功能已完成！🎉

