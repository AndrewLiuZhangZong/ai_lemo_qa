# AI智能客服问答系统开发计划

## 项目进度追踪

### ✅ Phase 0: 基础设施部署（已完成）
- [x] Docker Compose环境搭建
- [x] PostgreSQL数据库部署
- [x] Redis缓存部署
- [x] Milvus向量数据库部署
- [x] Ollama LLM部署（Qwen3-8B）

### ✅ Phase 1: 项目初始化（已完成）
- [x] 创建Python项目结构
- [x] 配置依赖管理（requirements.txt）
- [x] 配置环境变量管理
- [x] 创建数据库连接模块
- [x] 创建日志配置

### ✅ Phase 2: 数据层开发（已完成）
- [x] 定义SQLAlchemy数据模型
- [x] 创建数据库会话管理
- [x] 实现知识库CRUD操作
- [x] 实现对话历史记录功能

### ✅ Phase 3: 核心服务开发（已完成）
- [x] Embedding服务（文本向量化）
  - 集成Ollama Embedding API
  - 实现文本批量向量化
- [x] Milvus服务（向量检索）
  - 创建向量集合
  - 实现向量存储和检索
  - 实现相似度搜索
- [x] LLM服务（问答生成）
  - 集成Ollama Chat API
  - 实现Prompt工程
  - 实现上下文管理
- [x] 对话服务（核心业务逻辑）
  - 实现问答流程编排
  - 实现知识检索+LLM增强

### 🔄 Phase 4: API接口开发（进行中）
- [x] 创建FastAPI应用
- [x] 实现问答接口（/api/v1/chat）
- [x] 实现知识库管理接口
  - POST /api/v1/knowledge - 添加知识
  - GET /api/v1/knowledge - 查询知识
  - PUT /api/v1/knowledge/{id} - 更新知识
  - DELETE /api/v1/knowledge/{id} - 删除知识
- [ ] 实现反馈接口（/api/v1/feedback）
- [ ] 实现健康检查接口（/health）
- [x] 配置CORS和中间件

### 🚀 Phase 5: 部署与上线
- [ ] 创建Dockerfile
- [ ] 更新docker-compose.yml
- [ ] 配置Nginx反向代理
- [ ] 生产环境部署文档

---

## 项目目录结构

```
ai_lemo_qa/
├── app/                        # 应用主目录
│   ├── __init__.py
│   ├── main.py                 # FastAPI应用入口
│   ├── api/                    # API路由
│   │   ├── __init__.py
│   │   ├── v1/                 # API v1版本
│   │   │   ├── __init__.py
│   │   │   ├── chat.py         # 问答接口
│   │   │   ├── knowledge.py    # 知识库管理接口
│   │   │   └── feedback.py     # 反馈接口
│   │   └── deps.py             # 依赖注入
│   ├── core/                   # 核心配置
│   │   ├── __init__.py
│   │   ├── config.py           # 配置管理
│   │   ├── database.py         # 数据库连接
│   │   └── logger.py           # 日志配置
│   ├── models/                 # 数据模型
│   │   ├── __init__.py
│   │   ├── knowledge.py        # 知识库模型
│   │   ├── conversation.py     # 对话历史模型
│   │   └── feedback.py         # 反馈模型
│   ├── schemas/                # Pydantic模型（数据验证）
│   │   ├── __init__.py
│   │   ├── chat.py             # 聊天请求/响应模型
│   │   ├── knowledge.py        # 知识库模型
│   │   └── feedback.py         # 反馈模型
│   ├── services/               # 业务逻辑服务
│   │   ├── __init__.py
│   │   ├── embedding.py        # Embedding服务
│   │   ├── milvus.py           # Milvus向量检索
│   │   ├── llm.py              # LLM对话服务
│   │   ├── redis.py            # Redis会话管理
│   │   └── chat.py             # 问答业务逻辑
│   └── utils/                  # 工具函数
│       ├── __init__.py
│       └── text.py             # 文本处理工具
├── scripts/                    # 脚本目录
│   ├── init.sql                # 数据库初始化
│   └── init_milvus.py          # Milvus初始化
├── docker-compose.yml          # Docker编排
├── Dockerfile                  # 应用容器化
├── requirements.txt            # Python依赖
├── .env                        # 环境变量
├── .env.example                # 环境变量示例
├── README.md                   # 项目说明
└── 需求文档.md                  # 需求文档
```

---

## 技术栈说明

### 后端框架
- **FastAPI**: 现代、快速的Web框架
- **Uvicorn**: ASGI服务器
- **Pydantic**: 数据验证

### 数据库
- **SQLAlchemy**: ORM框架
- **asyncpg**: 异步PostgreSQL驱动
- **redis-py**: Redis客户端

### AI/ML
- **langchain**: LLM应用框架
- **ollama**: 本地LLM客户端
- **pymilvus**: Milvus Python SDK

### 工具
- **python-dotenv**: 环境变量管理
- **loguru**: 日志管理
- **httpx**: HTTP客户端

---

## 开发顺序

### 第一步：核心配置（今天完成）
1. 安装Python依赖
2. 创建配置管理模块
3. 测试数据库连接
4. 测试Ollama连接

### 第二步：数据模型（今天完成）
1. 定义SQLAlchemy模型
2. 创建Pydantic Schema
3. 测试数据库操作

### 第三步：服务层（明天）
1. 实现Embedding服务
2. 实现Milvus向量存储和检索
3. 实现LLM对话服务
4. 集成测试

### 第四步：API接口（明天）
1. 创建FastAPI应用
2. 实现问答接口
3. 实现知识库管理接口
4. API测试

### 第五步：完善功能（后天）
1. 添加会话管理
2. 添加错误处理
3. 添加日志记录
4. 性能优化

---

## 预期效果

### API示例

**问答接口**
```bash
curl -X POST "http://localhost:8080/api/v1/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "如何退货？",
    "session_id": "test-session-123"
  }'

# 响应
{
  "code": 200,
  "data": {
    "answer": "您可以在订单页面申请退货...",
    "confidence": 0.92,
    "sources": [{"id": 1, "question": "如何退货？"}],
    "related_questions": ["退货需要多久？", "退货运费谁承担？"]
  }
}
```

**添加知识**
```bash
curl -X POST "http://localhost:8080/api/v1/knowledge" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "如何修改订单地址？",
    "answer": "订单提交后30分钟内可自助修改地址...",
    "category": "订单问题"
  }'
```

---

## 性能目标

- **响应时间**: < 2秒
- **并发能力**: 50+ QPS
- **准确率**: > 85%
- **可用性**: 99%+

---

## 下一步行动

1. ✅ 创建项目结构
2. ✅ 编写核心配置代码
3. ✅ 编写数据模型和服务层
4. ✅ 实现API接口
5. 🔄 安装Python依赖
6. 🧪 本地测试运行
7. 📝 完善反馈接口和健康检查

继续完善！🚀

