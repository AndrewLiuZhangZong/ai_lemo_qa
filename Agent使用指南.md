# ğŸ¯ å¤šAgentæ¶æ„ä½¿ç”¨æŒ‡å—

## âœ¨ æ¶æ„æ¦‚è§ˆ

ç³»ç»Ÿç°åœ¨é‡‡ç”¨**å¯æ‰©å±•çš„å¤šAgentæ¶æ„**ï¼Œæ”¯æŒè‡ªåŠ¨è·¯ç”±åˆ°ä¸“ä¸šAgentå¤„ç†ä¸åŒç±»å‹çš„é—®é¢˜ã€‚

```
AgentManager (è‡ªåŠ¨è·¯ç”±)
â”œâ”€â”€ å¤©æ°”ä¸“å®¶Agent â†’ å¤„ç†å¤©æ°”æŸ¥è¯¢
â””â”€â”€ é€šç”¨åŠ©æ‰‹Agent â†’ å¤„ç†å…¶ä»–é—®é¢˜ï¼ˆçŸ¥è¯†åº“ã€è®¡ç®—ã€ç™¾ç§‘ç­‰ï¼‰
```

### ğŸ”„ å·¥ä½œæµç¨‹

1. **ç”¨æˆ·æé—®** â†’ Agent Manager
2. **æ™ºèƒ½è·¯ç”±** â†’ æ ¹æ®é—®é¢˜å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„Agent
3. **å·¥å…·é“¾ä¸²è”** â†’ Agentè°ƒç”¨å¤šä¸ªå·¥å…·å®Œæˆä»»åŠ¡
4. **è¿”å›ç»“æœ** â†’ ç”Ÿæˆå‹å¥½çš„å›ç­”

---

## ğŸŒ¤ï¸ å¤©æ°”Agentä½¿ç”¨æŒ‡å—

### åŠŸèƒ½ç‰¹æ€§

- âœ… **å·¥å…·é“¾ä¸²è”**ï¼šæ—¶é—´è§£æ â†’ åœ°ç‚¹è§£æ â†’ å¤©æ°”APIæŸ¥è¯¢
- âœ… **æ™ºèƒ½è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å¤©æ°”ç›¸å…³é—®é¢˜
- âœ… **è¯¦ç»†ä¿¡æ¯**ï¼šæ¸©åº¦ã€ä½“æ„Ÿã€é£åŠ›ã€æ¹¿åº¦ã€èƒ½è§åº¦ç­‰
- âœ… **ä¸­æ–‡æ”¯æŒ**ï¼šæ”¯æŒä¸­æ–‡åŸå¸‚åç§°æŸ¥è¯¢

### ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œå’Œé£å¤©æ°”API

1. **è®¿é—®å®˜ç½‘**
   ```
   https://dev.qweather.com/
   ```

2. **æ³¨å†Œè´¦å·**
   - ç‚¹å‡»"å…è´¹æ³¨å†Œ"
   - å¡«å†™é‚®ç®±å’Œå¯†ç 
   - éªŒè¯é‚®ç®±

3. **åˆ›å»ºåº”ç”¨**
   - ç™»å½•åè¿›å…¥"æ§åˆ¶å°"
   - ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"
   - é¡¹ç›®åç§°ï¼š`ai_lemo_qa`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
   - ç‚¹å‡»"åˆ›å»ºåº”ç”¨"
   - åº”ç”¨åç§°ï¼š`å¤©æ°”æŸ¥è¯¢`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
   - **é€‰æ‹©æ–¹æ¡ˆ**ï¼š`å…è´¹è®¢é˜…` ï¼ˆæ¯å¤©1000æ¬¡è¯·æ±‚ï¼‰
   - æäº¤

4. **è·å–API Key**
   - è¿›å…¥"åº”ç”¨ç®¡ç†"
   - å¤åˆ¶ `KEY` å€¼ï¼ˆå½¢å¦‚ï¼š`a1b2c3d4e5f6g7h8i9j0`ï¼‰

5. **é…ç½®åˆ°ç³»ç»Ÿ**
   
   ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ ï¼š
   ```bash
   # å’Œé£å¤©æ°” API é…ç½®
   QWEATHER_API_KEY=ä½ çš„API_KEY
   ```
   
   **ç¤ºä¾‹**ï¼š
   ```bash
   QWEATHER_API_KEY=a1b2c3d4e5f6g7h8i9j0
   ```

6. **é‡å¯æœåŠ¡**
   ```bash
   # åœæ­¢ç°æœ‰æœåŠ¡
   lsof -ti:8080 | xargs kill -9
   
   # å¯åŠ¨æœåŠ¡
   cd /Users/edy/PycharmProjects/ai_lemo_qa
   source venv/bin/activate
   uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload
   ```

---

### ç¬¬äºŒæ­¥ï¼šæµ‹è¯•å¤©æ°”æŸ¥è¯¢

#### æµ‹è¯•ç”¨ä¾‹

1. **åŸºç¡€æŸ¥è¯¢**
   ```
   åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
   ä¸Šæµ·ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ
   å¹¿å·å¸‚çš„å¤©æ°”
   ```

2. **å¸¦åŒºå¿æŸ¥è¯¢**
   ```
   åŒ—äº¬å¸‚é€šå·åŒºå¤©æ°”
   ä¸Šæµ·æµ¦ä¸œæ–°åŒºçš„å¤©æ°”
   ```

3. **è‡ªç„¶è¯­è¨€æŸ¥è¯¢**
   ```
   ä»Šå¤©åŒ—äº¬å†·ä¸å†·ï¼Ÿ
   ä¸Šæµ·éœ€è¦å¸¦ä¼å—ï¼Ÿ
   å¹¿å·ä»Šå¤©æ°”æ¸©å¤šå°‘ï¼Ÿ
   ```

#### é¢„æœŸè¿”å›æ ¼å¼

```
ä»Šå¤©ï¼ˆ2025å¹´10æœˆ21æ—¥ï¼‰åŒ—äº¬çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š

ğŸŒ¡ï¸ **æ¸©åº¦**ï¼š20Â°Cï¼ˆä½“æ„Ÿ 18Â°Cï¼‰
ğŸŒ¤ï¸  **å¤©æ°”**ï¼šæ™´
ğŸ’¨ **é£åŠ›**ï¼šè¥¿åŒ—é£ 3çº§
ğŸ’§ **æ¹¿åº¦**ï¼š45%
ğŸ‘ï¸  **èƒ½è§åº¦**ï¼š10 km

æ•°æ®æ›´æ–°æ—¶é—´ï¼š2025-10-21T19:30:00+08:00
```

#### è·¯ç”±æ—¥å¿—

æŸ¥çœ‹æ—¥å¿—å¯ä»¥çœ‹åˆ°Agentçš„è·¯ç”±è¿‡ç¨‹ï¼š
```
[è·¯ç”±] å¤©æ°”ä¸“å®¶: can_handle=True, confidence=0.90
ğŸ¯ è·¯ç”±åˆ°ä¸“ä¸š Agent: å¤©æ°”ä¸“å®¶ (ç½®ä¿¡åº¦=0.90)
[å·¥å…·é“¾-1] æ—¶é—´ä¸Šä¸‹æ–‡: ä»Šå¤©ï¼ˆ2025å¹´10æœˆ21æ—¥ï¼‰
[å·¥å…·é“¾-2] æå–åŸå¸‚: åŒ—äº¬
ğŸŒ æ‰¾åˆ°åŸå¸‚: åŒ—äº¬ (ID: 101010100)
ğŸŒ¤ï¸  è·å–å¤©æ°”æˆåŠŸ: åŒ—äº¬ 20Â°C æ™´
```

---

## ğŸ¤– é€šç”¨AgentåŠŸèƒ½

é€šç”¨Agentç»§ç»­ä¿ç•™åŸæœ‰åŠŸèƒ½ï¼Œå¤„ç†éå¤©æ°”ç±»é—®é¢˜ï¼š

### åŠŸèƒ½åˆ—è¡¨

1. **çŸ¥è¯†åº“æŸ¥è¯¢**
   ```
   å¦‚ä½•é€€è´§ï¼Ÿ
   è®¢å•æ€ä¹ˆæŸ¥è¯¢ï¼Ÿ
   äº§å“æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ
   ```

2. **æ—¥æœŸæ—¶é—´**
   ```
   ä»Šå¤©å‡ å·ï¼Ÿ
   ç°åœ¨å‡ ç‚¹ï¼Ÿ
   ```

3. **æ•°å­¦è®¡ç®—**
   ```
   123 * 456 ç­‰äºå¤šå°‘ï¼Ÿ
   (100 + 50) / 2
   ```

4. **ç™¾ç§‘çŸ¥è¯†**
   ```
   ä»‹ç»ä¸€ä¸‹äººå·¥æ™ºèƒ½
   ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿ
   ```

---

## ğŸ”§ æ‰©å±•æ–°Agentï¼ˆå¼€å‘è€…æŒ‡å—ï¼‰

### 1. åˆ›å»ºæ–°çš„Agent

åœ¨ `app/services/agents/` ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼Œä¾‹å¦‚ `order_agent.py`ï¼š

```python
from typing import Dict, List, Optional
from .base import BaseAgent
from loguru import logger

class OrderAgent(BaseAgent):
    """è®¢å•å¤„ç†ä¸“å®¶Agent"""
    
    def __init__(self):
        super().__init__(
            name="è®¢å•ä¸“å®¶",
            description="ä¸“é—¨å¤„ç†è®¢å•æŸ¥è¯¢ã€é€€è´§ç­‰è®¢å•ç›¸å…³é—®é¢˜"
        )
        # åˆå§‹åŒ–å·¥å…·...
    
    async def can_handle(self, message: str) -> tuple[bool, float]:
        """åˆ¤æ–­æ˜¯å¦ä¸ºè®¢å•ç›¸å…³é—®é¢˜"""
        keywords = ["è®¢å•", "é€€è´§", "ç‰©æµ", "å¿«é€’"]
        if any(kw in message for kw in keywords):
            return True, 0.8
        return False, 0.0
    
    async def chat(self, message: str, chat_history: Optional[List[Dict]] = None) -> Dict:
        """å¤„ç†è®¢å•é—®é¢˜"""
        # å·¥å…·é“¾é€»è¾‘...
        return {
            "answer": "...",
            "answer_source": "order_agent",
            "confidence": 0.9,
            "tools_used": []
        }
```

### 2. æ³¨å†Œåˆ°Manager

åœ¨ `app/services/chat.py` ä¸­æ³¨å†Œï¼š

```python
from .agents.order_agent import get_order_agent

# æ³¨å†Œè®¢å•Agent
agent_manager.register_agent(get_order_agent())
```

### 3. è‡ªåŠ¨è·¯ç”±

ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ® `can_handle()` æ–¹æ³•çš„è¿”å›å€¼é€‰æ‹©æœ€åˆé€‚çš„Agentã€‚

---

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹Agentè·¯ç”±æ—¥å¿—

```bash
tail -f logs/app_$(date +%Y-%m-%d).log | grep "è·¯ç”±"
```

### æŸ¥çœ‹å·¥å…·è°ƒç”¨é“¾

```bash
tail -f logs/app_$(date +%Y-%m-%d).log | grep "å·¥å…·é“¾"
```

### æŸ¥çœ‹Agentæ‰§è¡Œæƒ…å†µ

```bash
tail -f logs/app_$(date +%Y-%m-%d).log | grep "Agent"
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¤©æ°”æŸ¥è¯¢è¿”å›"API Keyæœªé…ç½®"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤å·²åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½® `QWEATHER_API_KEY`
2. ç¡®è®¤Keyæ²¡æœ‰å¤šä½™ç©ºæ ¼
3. é‡å¯æœåŠ¡

### Q2: å¤©æ°”æŸ¥è¯¢è¿”å›"æœªæ‰¾åˆ°åŸå¸‚"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åŸå¸‚åç§°æ‹¼å†™
2. å°è¯•ä½¿ç”¨å…¨åï¼ˆå¦‚ï¼šåŒ—äº¬å¸‚ã€ä¸Šæµ·å¸‚ï¼‰
3. åŒºå¿æŸ¥è¯¢ï¼šåŒ—äº¬å¸‚é€šå·åŒº

### Q3: å¦‚ä½•æŸ¥çœ‹å“ªä¸ªAgentå¤„ç†äº†æˆ‘çš„é—®é¢˜ï¼Ÿ

æŸ¥çœ‹æ—¥å¿—ä¸­çš„ `[Agentæ¨¡å¼] å®Œæˆ` è¡Œï¼š
```
[Agentæ¨¡å¼] å®Œæˆ: agent=å¤©æ°”ä¸“å®¶, ...
```

### Q4: ä¸ºä»€ä¹ˆå¤©æ°”é—®é¢˜è¢«é€šç”¨Agentå¤„ç†äº†ï¼Ÿ

å¦‚æœç½®ä¿¡åº¦ä¸å¤Ÿé«˜ï¼ˆ< 0.5ï¼‰ï¼Œä¼šfallbackåˆ°é€šç”¨Agentã€‚å¯ä»¥ï¼š
1. ä½¿ç”¨æ›´æ˜ç¡®çš„å…³é”®è¯ï¼ˆå¤©æ°”ã€æ°”æ¸©ç­‰ï¼‰
2. å®Œæ•´çš„åŸå¸‚åç§°

### Q5: å¯ä»¥æ·»åŠ æœªæ¥å¤©æ°”é¢„æŠ¥å—ï¼Ÿ

å¯ä»¥ï¼åœ¨ `weather_tool.py` ä¸­æ·»åŠ  `get_weather_forecast()` æ–¹æ³•ï¼Œ
ç„¶ååœ¨ `WeatherAgent` ä¸­è¯†åˆ«"æ˜å¤©"ã€"æœªæ¥"ç­‰å…³é”®è¯ã€‚

---

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

### ç›¸æ¯”ä¹‹å‰çš„æ”¹è¿›

| æ–¹é¢ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| **æ¶æ„** | å•ä¸€Agent | å¤šä¸“ä¸šAgent + è‡ªåŠ¨è·¯ç”± |
| **å¤©æ°”æŸ¥è¯¢** | ä¾èµ–DuckDuckGoï¼ˆé¢‘ç‡é™åˆ¶ï¼‰ | ä¸“ä¸šå¤©æ°”APIï¼ˆç¨³å®šï¼‰ |
| **æ‰©å±•æ€§** | è¾ƒéš¾æ‰©å±• | æ˜“äºæ·»åŠ æ–°Agent |
| **ç²¾å‡†åº¦** | é€šç”¨å¤„ç† | ä¸“ä¸šAgentä¸“é¡¹ä¼˜åŒ– |
| **å“åº”** | "æ— æ³•å›ç­”" | è¯¦ç»†ç»“æ„åŒ–æ•°æ® |

### å·¥å…·é“¾ä¸²è”ç¤ºä¾‹

**å¤©æ°”æŸ¥è¯¢æµç¨‹**ï¼š
```
ç”¨æˆ·: "åŒ—äº¬ä»Šå¤©å†·ä¸å†·ï¼Ÿ"
  â†“
AgentManager: è·¯ç”±åˆ°"å¤©æ°”ä¸“å®¶" (ç½®ä¿¡åº¦ 0.9)
  â†“
å·¥å…·é“¾-1: æ—¶é—´è§£æ â†’ "ä»Šå¤©ï¼ˆ2025-10-21ï¼‰"
  â†“
å·¥å…·é“¾-2: åœ°ç‚¹è§£æ â†’ "åŒ—äº¬"
  â†“
å·¥å…·é“¾-3: å¤©æ°”API â†’ è°ƒç”¨å’Œé£å¤©æ°”
  â†“
è¿”å›: "ä»Šå¤©åŒ—äº¬20Â°Cï¼Œæ™´ï¼Œä¸å†·..."
```

---

## ğŸ“š ä¸‹ä¸€æ­¥æ‰©å±•å»ºè®®

1. **è®¢å•Agent** - å¤„ç†è®¢å•æŸ¥è¯¢ã€ç‰©æµè¿½è¸ª
2. **äº§å“Agent** - äº§å“æ¨èã€å‚æ•°å¯¹æ¯”
3. **å®¢æœAgent** - å”®åæœåŠ¡ã€æŠ•è¯‰å¤„ç†
4. **æ•°æ®åˆ†æAgent** - é”€å”®æ•°æ®ã€ç”¨æˆ·è¡Œä¸ºåˆ†æ

æ¯ä¸ªAgentéƒ½å¯ä»¥æœ‰è‡ªå·±çš„å·¥å…·é“¾å’Œä¸“ä¸šçŸ¥è¯†ï¼

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

